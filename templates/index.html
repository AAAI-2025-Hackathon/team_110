<!DOCTYPE html>
<html>
<head>
    <title>Truth Detector Challenge</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .score-board {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .container {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
        }

        .news-card {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e0e0e0;
        }

        .news-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .media-container {
            height: 250px;
            margin-bottom: 20px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            background-image: url('https://via.placeholder.com/400x250');
        }

        .summary {
            line-height: 1.6;
            color: #333;
            font-size: 16px;
        }

        .feedback {
            display: none;
            padding: 20px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
        }

        .correct {
            background: #e8f5e9;
            border: 2px solid #43a047;
            color: #2e7d32;
        }

        .incorrect {
            background: #ffebee;
            border: 2px solid #e53935;
            color: #c62828;
        }

        .loader {
            display: none;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .main-image-container {
            text-align: center;
            margin: 30px 0;
        }

        .main-image {
            width: 80%;
            max-width: 800px;
            height: 400px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .placeholder-text {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="score-board" id="score">
        Score: 0
    </div>

    <div class="header">
        <h1> Spot the Fake News</h1>
        <p>Test your media literacy skills - identify the misleading story</p>
    </div>

    <div class="main-image-container">
        <img src="https://via.placeholder.com/800x400" class="main-image" alt="News visual" id="mainImage">
    </div>

    <div class="container">
        <div class="news-card" id="news1" onclick="checkAnswer(1)">
            <div class="summary placeholder-text" id="news_summary_1">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
                Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div>
            <button onclick="speakText('news_summary_1')">Read Text</button>
        </div>
        
        <div class="news-card" id="news2" onclick="checkAnswer(2)">
            <div class="summary placeholder-text" id="news_summary_2">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
                Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div>
            <button onclick="speakText('news_summary_2')">Read Text</button>
        </div>
    </div>

    
    <div class="loader" id="loader"></div>
    <div class="feedback" id="feedback"></div>

    <script>
        // Add score tracking
        let score = 0;
        const scoreElement = document.getElementById('score');

        const stories = [
            {
                image: "https://picsum.photos/800/400",
                trueSummary: "Official data shows GDP grew 3.4% in Q2 2023, matching economist predictions.",
                fakeSummary: "Secret government reports reveal actual GDP plummeted 5.1% last quarter.",
                explanation: "The fake story uses unverified claims about 'secret reports'...",
                sources: ["BEA.gov", "Federal Reserve Economic Data"],
                fakePosition: 2
            },
            // Add more stories
        ];

        function updateStoryDisplay(story) {
            // Update main image
            document.getElementById('mainImage').src = story.image;
            
            // Update summaries
            document.getElementById('news1').querySelector('.summary').textContent = story.trueSummary;
            document.getElementById('news1').querySelector('.summary').classList.remove('placeholder-text');
            
            document.getElementById('news2').querySelector('.summary').textContent = story.fakeSummary;
            document.getElementById('news2').querySelector('.summary').classList.remove('placeholder-text');
        }

        // Modified checkAnswer function
        async function checkAnswer(selectedPosition) {
            showLoader();
            
            try {
                const response = await fetch('/verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        storyId: currentStory,
                        selectedPosition: selectedPosition
                    })
                });

                const result = await response.json();
                
                if(result.correct) {
                    score += 100;
                    scoreElement.textContent = `Score: ${score}`;
                    showFeedback(result, true);
                } else {
                    showFeedback(result, false);
                }
            } catch (error) {
                console.error('Error:', error);
            } finally {
                hideLoader();
            }
        }

        function showLoader() {
            document.getElementById('loader').style.display = 'block';
        }

        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
        }

        // Modified feedback system
        function showFeedback(result, isCorrect) {
            const feedback = document.getElementById('feedback');
            feedback.innerHTML = `
                <h3>${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h3>
                <p>${result.explanation}</p>
                ${result.sources ? `<div class="sources">Sources: ${result.sources}</div>` : ''}
            `;
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.style.display = 'block';
            
            setTimeout(async () => {
                feedback.style.display = 'none';
                await loadNextStory();
            }, 3000);
        }

        async function loadNextStory() {
            showLoader();
            try {
                const response = await fetch('/next-story');
                const story = await response.json();
                updateStoryDisplay(story);
            } catch (error) {
                console.error('Error loading story:', error);
            } finally {
                hideLoader();
            }
        }

        let isSpeaking = false; 
        let utterance = null;

        function speakText(selector, isClass = false) {
            if (isSpeaking) {
                window.speechSynthesis.cancel(); // Stop speech
                isSpeaking = false;
                return;
            }

            let text;
            if (isClass) {
                let elements = document.getElementsByClassName(selector);
                text = Array.from(elements).map(el => el.innerText).join(" ");
            } else {
                let element = document.getElementById(selector);
                text = element ? element.innerText : "";
            }

            if (text.trim() === "") {
                alert("No text found!");
                return;
            }

            utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = "en-US";
            utterance.rate = 1;
            utterance.pitch = 1;
            utterance.onend = () => isSpeaking = false; // Reset flag when done

            window.speechSynthesis.speak(utterance);
            isSpeaking = true;
        }

        // Stop speech when page is changed
        window.addEventListener("beforeunload", () => {
            window.speechSynthesis.cancel();
        });
    </script>
</body>
</html>